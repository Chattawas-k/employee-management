<div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
  <!-- Loading State -->
  @if (loading) {
    <div class="flex justify-center items-center py-12">
      <app-icon name="loader-2" class="animate-spin text-indigo-600" size="32"></app-icon>
    </div>
  }

  <!-- Table -->
  @if (!loading && data.length > 0) {
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead>
          <tr class="bg-slate-50 border-b border-slate-200">
            @for (column of columns; track column.key) {
              <th 
                [class]="'p-4 text-sm font-semibold text-slate-600 ' + (column.align === 'right' ? 'text-right' : column.align === 'center' ? 'text-center' : 'text-left')"
                [style.width]="column.width"
                [class.cursor-pointer]="column.sortable"
                [class.hover:bg-slate-100]="column.sortable"
                (click)="onSort(column)">
                <div class="flex items-center gap-2" [class.justify-end]="column.align === 'right'" [class.justify-center]="column.align === 'center'">
                  <span>{{ column.label }}</span>
                  @if (column.sortable) {
                    <div class="flex flex-col">
                      @if (getSortIcon(column) === 'chevron-up') {
                        <app-icon name="chevron-up" className="w-3 h-3 text-indigo-600" size="12"></app-icon>
                      } @else if (getSortIcon(column) === 'chevron-down') {
                        <app-icon name="chevron-down" className="w-3 h-3 text-indigo-600" size="12"></app-icon>
                      } @else {
                        <app-icon name="chevron-up" className="w-3 h-3 text-slate-300" size="12"></app-icon>
                        <app-icon name="chevron-down" className="w-3 h-3 text-slate-300 -mt-1" size="12"></app-icon>
                      }
                    </div>
                  }
                </div>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (item of data; track trackByFn ? trackByFn($index, item) : $index) {
            <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
              @for (column of columns; track column.key) {
                <td 
                  [class]="'p-4 ' + (column.align === 'right' ? 'text-right' : column.align === 'center' ? 'text-center' : 'text-left')"
                  [style.width]="column.width">
                  @if (column.template) {
                    <ng-container *ngTemplateOutlet="column.template; context: { $implicit: item, column: column }"></ng-container>
                  } @else {
                    <span class="text-slate-700">{{ getValue(item, column.key) }}</span>
                  }
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    @if (pagination && pagination.totalPages > 0) {
      <div class="border-t border-slate-200 p-4">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
          <!-- Results Info -->
          <div class="text-sm text-slate-600">
            แสดง <span class="font-medium">{{ (pagination.pageNumber - 1) * pagination.pageSize + 1 }}</span> - 
            <span class="font-medium">{{ Math.min(pagination.pageNumber * pagination.pageSize, pagination.totalCount) }}</span> จาก 
            <span class="font-medium">{{ pagination.totalCount }}</span> รายการ
          </div>

          <!-- Pagination Controls -->
          <div class="flex items-center gap-2">
            <!-- First Page -->
            <button
              (click)="onPageChange(1)"
              [disabled]="pagination.pageNumber === 1 || loading"
              class="px-2 py-1 border border-slate-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors"
              title="หน้าแรก">
              <app-icon name="chevron-right" className="w-4 h-4 rotate-180"></app-icon>
            </button>

            <!-- Previous Page -->
            <button
              (click)="onPageChange(pagination.pageNumber - 1)"
              [disabled]="!pagination.hasPreviousPage || loading"
              class="px-3 py-1 border border-slate-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors">
              ก่อนหน้า
            </button>

            <!-- Page Numbers -->
            <div class="flex items-center gap-1">
              @for (page of getPageNumbers(); track page) {
                @if (page === -1) {
                  <span class="px-2 text-slate-400">...</span>
                } @else {
                  <button
                    (click)="onPageChange(page)"
                    [disabled]="loading"
                    [class.bg-indigo-600]="page === pagination.pageNumber"
                    [class.text-white]="page === pagination.pageNumber"
                    [class.border-indigo-600]="page === pagination.pageNumber"
                    [class.text-slate-700]="page !== pagination.pageNumber"
                    [class.border-slate-300]="page !== pagination.pageNumber"
                    class="min-w-[2.5rem] px-3 py-1 border rounded-md text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors">
                    {{ page }}
                  </button>
                }
              }
            </div>

            <!-- Next Page -->
            <button
              (click)="onPageChange(pagination.pageNumber + 1)"
              [disabled]="!pagination.hasNextPage || loading"
              class="px-3 py-1 border border-slate-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors">
              ถัดไป
            </button>

            <!-- Last Page -->
            <button
              (click)="onPageChange(pagination.totalPages)"
              [disabled]="pagination.pageNumber === pagination.totalPages || loading"
              class="px-2 py-1 border border-slate-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 transition-colors"
              title="หน้าสุดท้าย">
              <app-icon name="chevron-right" className="w-4 h-4"></app-icon>
            </button>
          </div>
        </div>
      </div>
    }
  }

  <!-- Empty State -->
  @if (!loading && data.length === 0) {
    <div class="p-12 text-center">
      <app-icon name="file-text" class="text-slate-400 mx-auto mb-4" size="48"></app-icon>
      <p class="text-slate-600 mb-2">{{ emptyMessage }}</p>
    </div>
  }
</div>

