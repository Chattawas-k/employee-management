<div class="space-y-6">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <h2 class="text-2xl font-bold text-slate-800">วันหยุดประจำปี (Annual Holidays)</h2>
    <div class="flex gap-2 w-full sm:w-auto">
      <select 
        class="bg-white border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
        [value]="selectedYear()"
        (change)="selectedYear.set(+$any($event.target).value)"
      >
        @for (year of uniqueYears(); track year) {
          <option [value]="year">ปี พ.ศ. {{ year + 543 }}</option>
        }
      </select>
      <app-button variant="primary" icon="plus" (onClick)="handleAddClick()">เพิ่มวันหยุด</app-button>
    </div>
  </div>

  <app-table
    [columns]="tableColumns()"
    [data]="filteredHolidays()"
    emptyMessage="ไม่มีข้อมูลวันหยุดในปีนี้"
    [trackByFn]="trackByHolidayId">
    
    <!-- Custom template for date column -->
    <ng-template #dateTemplate let-holiday>
      <div class="flex items-center gap-2">
        <app-icon name="calendar-days" className="w-4 h-4 text-indigo-500"></app-icon>
        <span class="text-slate-600 font-medium">{{ getThaiDatePreview(holiday.date) }}</span>
      </div>
    </ng-template>

    <!-- Custom template for actions column -->
    <ng-template #actionsTemplate let-holiday>
      <div class="flex items-center justify-end gap-2">
        <app-action-button variant="edit" title="แก้ไข" (onClick)="handleEditClick(holiday)"></app-action-button>
        <app-action-button variant="delete" title="ลบ" (onClick)="confirmDelete(holiday.id)"></app-action-button>
      </div>
    </ng-template>
  </app-table>

  <!-- Add/Edit Modal -->
  <app-modal 
    [isOpen]="isModalOpen()" 
    (onClose)="isModalOpen.set(false)" 
    [title]="editingHoliday() ? 'แก้ไขวันหยุด' : 'เพิ่มวันหยุดประจำปี'"
  >
    <div class="space-y-4">
      @if (errorMessage()) {
        <div class="bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-600">
          {{ errorMessage() }}
        </div>
      }
      <div>
        <app-input
          type="date"
          label="วันที่"
          [(ngModel)]="formData.date"
          name="holidayDate"
          [error]="fieldErrors()['date']"
          [required]="true">
        </app-input>
        @if (formData.date) {
          <p class="text-xs text-indigo-600 mt-1 ml-1">
            แสดงผล: {{ getThaiDatePreview(formData.date) }}
          </p>
        }
      </div>
      <app-input
        type="text"
        label="ชื่อวันหยุด"
        placeholder="ตัวอย่าง: วันสงกรานต์"
        [(ngModel)]="formData.name"
        name="holidayName"
        [error]="fieldErrors()['name']"
        [required]="true">
      </app-input>
      <div class="flex justify-end gap-2 pt-4">
        <app-button variant="secondary" (onClick)="isModalOpen.set(false)">ยกเลิก</app-button>
        <app-button variant="primary" (onClick)="handleSave()">{{ editingHoliday() ? 'บันทึกการแก้ไข' : 'เพิ่มวันหยุด' }}</app-button>
      </div>
    </div>
  </app-modal>

  <!-- Delete Confirm Modal -->
  <app-confirm-modal
    [isOpen]="isConfirmModalOpen()"
    title="ยืนยันการลบ"
    [message]="confirmMessage()"
    confirmText="ยืนยันลบ"
    cancelText="ยกเลิก"
    variant="danger"
    (onConfirm)="handleConfirmDelete()"
    (onCancel)="handleCancelDelete()">
  </app-confirm-modal>
</div>
