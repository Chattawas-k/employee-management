<div class="space-y-6">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <h2 class="text-2xl font-bold text-slate-800">ตารางงาน (Schedules)</h2>
    <div class="flex gap-2 items-center text-sm text-slate-500">
      <span class="flex items-center">
        <div class="w-3 h-3 bg-green-100 rounded-full mr-1 border border-green-200"></div>
        ว่าง
      </span>
      <span class="flex items-center">
        <div class="w-3 h-3 bg-orange-100 rounded-full mr-1 border border-orange-200"></div>
        ไม่ว่าง
      </span>
      <span class="flex items-center">
        <div class="w-3 h-3 bg-slate-100 rounded-full mr-1 border border-slate-200"></div>
        หยุด
      </span>
    </div>
  </div>
  
  <div class="bg-white rounded-xl border border-slate-200 overflow-hidden relative">
    <div class="overflow-x-auto">
      <table class="w-full text-center border-collapse">
        <thead>
          <tr class="bg-slate-50 border-b border-slate-200">
            <th class="p-4 text-left min-w-[150px] font-semibold text-slate-600 sticky left-0 bg-slate-50 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">พนักงาน</th>
            @for (day of days; track day) {
              <th class="p-4 min-w-[80px] font-semibold text-slate-600">{{ dayLabels[day] }}</th>
            }
            <th class="p-4 min-w-[60px] font-semibold text-slate-600">แก้ไข</th>
          </tr>
        </thead>
        <tbody>
          @for (emp of employees(); track emp.id) {
            @if (emp.status !== 'Inactive') {
              <tr class="border-b border-slate-100 hover:bg-slate-50">
                <td class="p-4 text-left font-medium text-slate-800 sticky left-0 bg-white z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] whitespace-nowrap">
                  <div class="flex items-center gap-3">
                    <app-avatar [src]="emp.avatar" [alt]="emp.name" size="sm"></app-avatar>
                    <span>{{ emp.name }}</span>
                  </div>
                </td>
                @for (day of days; track day) {
                  <td class="p-2">
                    <div class="w-full py-1.5 rounded text-xs font-medium border" [ngClass]="getStatusColor(getDayStatus(emp.id, day))">
                      {{ getStatusLabel(getDayStatus(emp.id, day)) }}
                    </div>
                  </td>
                }
                <td class="p-2">
                  <button 
                    (click)="handleEditClick(emp.id)"
                    class="p-2 text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors"
                  >
                    <app-icon name="edit" className="w-4 h-4"></app-icon>
                  </button>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Edit Schedule Modal -->
  <app-modal 
    [isOpen]="isEditModalOpen()" 
    (onClose)="isEditModalOpen.set(false)" 
    [title]="'แก้ไขตารางงาน: ' + (editingSchedule() ? getEmpName(editingSchedule()!.empId) : '')"
    size="md"
  >
    @if (editingSchedule()) {
      <div class="space-y-4">
        <div class="bg-slate-50 p-3 rounded-lg mb-4 text-sm text-slate-600">
          กำหนดสถานะการทำงานในแต่ละวันของพนักงาน (รายสัปดาห์)
        </div>
        
        <div class="space-y-3">
          @for (day of days; track day) {
            <div class="flex items-center justify-between border-b border-slate-100 pb-2 last:border-0">
              <span class="font-medium text-slate-700 w-20">{{ dayLabels[day] }}</span>
              <div class="flex gap-2">
                @for (statusOption of statusOptions; track statusOption) {
                  <button
                    type="button"
                    (click)="handleStatusChange(day, statusOption)"
                    class="px-3 py-1.5 rounded text-xs border transition-all"
                    [ngClass]="getDayStatusForEdit(day) === statusOption ? getStatusColor(statusOption) + ' ring-2 ring-offset-1 ring-indigo-100 font-bold' : 'bg-white border-slate-200 text-slate-500 hover:bg-slate-50'"
                  >
                    {{ getStatusLabel(statusOption) }}
                  </button>
                }
              </div>
            </div>
          }
        </div>

        <div class="flex justify-end gap-3 pt-4 mt-4 border-t border-slate-100">
          <app-button variant="secondary" (onClick)="isEditModalOpen.set(false)">ยกเลิก</app-button>
          <app-button variant="primary" (onClick)="handleSave()" icon="save">บันทึกตารางงาน</app-button>
        </div>
      </div>
    }
  </app-modal>
</div>
