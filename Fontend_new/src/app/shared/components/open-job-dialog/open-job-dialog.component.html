<div class="fixed inset-0 z-40 bg-black/50 flex items-center justify-center p-4" (click)="close.emit()">
  <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl flex flex-col" (click)="$event.stopPropagation()">
    <header class="p-5 border-b border-gray-200 flex justify-between items-center">
      @if (isEditMode() && task) {
        <h2 class="text-xl font-medium text-gray-800">ดำเนินการ: งาน {{ task.id }}</h2>
      } @else {
        <h2 class="text-xl font-medium text-gray-800">ดำเนินการ: {{ userName }}</h2>
      }
      <button (click)="close.emit()" class="text-gray-400 hover:text-gray-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </header>

    <main class="p-6 space-y-5">
      @if (!isEditMode()) {
        <div class="p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-4">
          <div class="w-10 h-10 flex-shrink-0 bg-white rounded-full flex items-center justify-center border-2 border-green-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <div>
            <h3 class="font-medium text-green-800">เปิดใบงานใหม่ (Open New Job)</h3>
            <p class="text-base text-green-700">กรุณากรอกข้อมูลลูกค้าเบื้องต้นเพื่อบันทึกเข้าระบบ</p>
          </div>
        </div>
      }

      <form [formGroup]="jobForm" class="space-y-4">
        <div>
          <label for="jobTitle" class="block text-base font-medium text-gray-600 mb-1">ชื่องาน (Job Title)</label>
          <input type="text" id="jobTitle" formControlName="jobTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
          <label for="customerName" class="block text-base font-medium text-gray-600 mb-1">ชื่อลูกค้า (Customer Name)</label>
          <input type="text" id="customerName" formControlName="customerName" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
        </div>

        <div>
          <label class="block text-base font-medium text-gray-600 mb-2">ความสำคัญ (Priority)</label>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <input class="sr-only peer" type="radio" value="Normal" formControlName="priority" id="priority_normal">
              <label class="flex items-center justify-center p-3 border rounded-lg cursor-pointer focus:outline-none hover:bg-gray-50 peer-checked:ring-indigo-500 peer-checked:ring-2 peer-checked:border-transparent peer-checked:bg-indigo-50" for="priority_normal">
                <span class="text-base font-medium text-gray-700">ทั่วไป (Normal)</span>
              </label>
            </div>
            <div>
              <input class="sr-only peer" type="radio" value="Urgent" formControlName="priority" id="priority_urgent">
              <label class="flex items-center justify-center p-3 border rounded-lg cursor-pointer focus:outline-none hover:bg-gray-50 peer-checked:ring-orange-500 peer-checked:ring-2 peer-checked:border-transparent peer-checked:bg-orange-50" for="priority_urgent">
                <span class="text-base font-medium text-gray-700">ด่วน (Urgent)</span>
              </label>
            </div>
          </div>
        </div>

        <div>
          <label for="details" class="block text-base font-medium text-gray-600 mb-1">รายละเอียดเพิ่มเติม</label>
          <textarea id="details" formControlName="details" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
        </div>
      </form>
    </main>

    <footer class="p-6 bg-gray-50 border-t border-gray-200 flex justify-end items-center gap-3 rounded-b-2xl">
      <button type="button" (click)="close.emit()" class="px-6 py-2 border border-gray-300 rounded-lg text-base font-medium text-gray-700 bg-white hover:bg-gray-100 transition-colors">
        ย้อนกลับ
      </button>
      <button type="button" (click)="onConfirm()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg text-base font-medium hover:bg-indigo-700 transition-colors flex items-center gap-2">
        @if (isEditMode()) {
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
          </svg>
          <span>ยืนยันและเริ่มงาน</span>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>ยืนยัน (Confirm)</span>
        }
      </button>
    </footer>
  </div>
</div>
