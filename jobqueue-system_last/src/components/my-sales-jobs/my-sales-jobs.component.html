<div class="flex-1 p-4 sm:p-6 lg:p-8 bg-white min-h-screen">
  <!-- Header -->
  <header class="flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-center pb-6">
    <div class="flex items-center gap-4">
      <button (click)="menuClick.emit()" class="p-2 rounded-md text-gray-500 hover:bg-gray-100 lg:hidden" aria-label="Open menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <div>
        <h1 class="text-2xl font-medium text-gray-900">รายการงานขายของฉัน</h1>
      </div>
    </div>
    <div class="flex items-center gap-2">
       <div class="relative w-full sm:w-64">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        <input 
          type="text" 
          [(ngModel)]="searchTerm"
          placeholder="ค้นหาลูกค้า, รหัส, สินค้า..." 
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
      </div>
      <button class="hidden sm:flex items-center gap-2 px-4 py-2 border border-gray-200 bg-gray-50 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6-4.14 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>
        <span>ตัวกรอง</span>
      </button>
      <button class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg text-base font-medium hover:bg-indigo-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
        <span>เพิ่มงาน</span>
      </button>
    </div>
  </header>

  <!-- Tabs -->
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex flex-wrap gap-x-8 gap-y-2" aria-label="Tabs">
      <button (click)="setTab('pending')" [class]="activeTab() === 'pending' ? 'border-indigo-600 text-indigo-600 font-medium' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium'" class="whitespace-nowrap py-3 px-1 border-b-2 text-base flex items-center gap-2">
        รอตัดสินใจ <span class="px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600">{{ counts()['pending'] || 0 }}</span>
      </button>
      <button (click)="setTab('sold')" [class]="activeTab() === 'sold' ? 'border-indigo-600 text-indigo-600 font-medium' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium'" class="whitespace-nowrap py-3 px-1 border-b-2 text-base flex items-center gap-2">
        ขายแล้ว <span class="px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600">{{ counts()['sold'] || 0 }}</span>
      </button>
      <button (click)="setTab('lost')" [class]="activeTab() === 'lost' ? 'border-indigo-600 text-indigo-600 font-medium' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium'" class="whitespace-nowrap py-3 px-1 border-b-2 text-base flex items-center gap-2">
        แพ้/ยกเลิก <span class="px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-600">{{ counts()['lost'] || 0 }}</span>
      </button>
    </nav>
  </div>

  <!-- Table View (Desktop) -->
  <div class="mt-1 overflow-x-auto">
    <table class="hidden md:table min-w-full">
      <thead class="bg-white">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">ลูกค้า</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">สินค้า/บริการ</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">มูลค่างาน</th>
          <th scope="col" class="px-6 py-3 text-center text-sm font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">อัปเดตล่าสุด</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">
            @if (activeTab() === 'sold') {
              วันที่ขาย
            } @else {
              นัดถัดไป
            }
          </th>
          <th scope="col" class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        @for(job of filteredJobs(); track job.id) {
          <tr class="hover:bg-gray-50 cursor-pointer" 
              [class.border-l-4]="isAppointmentUrgent(job.nextAppointment) || isAppointmentOverdue(job.nextAppointment)"
              [class.border-yellow-400]="isAppointmentUrgent(job.nextAppointment)"
              [class.border-red-500]="isAppointmentOverdue(job.nextAppointment)">
            <td class="px-6 py-4 whitespace-nowrap">
                <div>
                  <div class="text-base font-medium text-gray-900">{{ job.customer.name }}</div>
                  <div class="text-base text-gray-500">{{ job.id }}</div>
                </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-base text-gray-800 max-w-xs truncate">{{ job.productService }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-base text-gray-800 font-medium">{{ 'THB' + (job.value | number:'1.0-0') }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-center">
              <span class="px-2.5 py-1 inline-flex text-sm leading-5 font-medium rounded-full" [class]="job.subStatusClass">
                {{ job.subStatus }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-base text-gray-500">{{ getRelativeTime(job.lastUpdated) }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-base" 
                [class.text-gray-800]="activeTab() === 'sold'"
                [class.font-medium]="activeTab() !== 'sold' && isAppointmentInFuture(job.nextAppointment)"
                [class.text-red-600]="activeTab() !== 'sold' && isAppointmentOverdue(job.nextAppointment)">
                @if (activeTab() === 'sold') {
                  {{ formatThaiDate(job.saleDate) }}
                } @else {
                  {{ formatThaiDate(job.nextAppointment) }}
                }
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-base font-medium">
              <button class="text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" /></svg>
              </button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="7" class="text-center py-12">
              <h3 class="text-xl font-medium text-gray-800">ไม่มีรายการ</h3>
              <p class="text-base text-gray-500 mt-1">ไม่พบงานขายในสถานะนี้</p>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
  
  <!-- List View (Mobile) -->
  <div class="md:hidden mt-4 space-y-3">
     @for(job of filteredJobs(); track job.id) {
        <div class="bg-white rounded-lg p-4 shadow-sm border cursor-pointer"
             [class.border-l-4]="isAppointmentUrgent(job.nextAppointment) || isAppointmentOverdue(job.nextAppointment)"
             [class.border-yellow-400]="isAppointmentUrgent(job.nextAppointment)"
             [class.border-red-500]="isAppointmentOverdue(job.nextAppointment)">
          <div class="flex justify-between items-start">
            <p class="font-medium text-gray-800">{{ job.customer.name }}</p>
            <span class="px-2 py-0.5 inline-flex text-sm leading-5 font-medium rounded-full" [class]="job.subStatusClass">
              {{ job.subStatus }}
            </span>
          </div>
          <div class="text-base text-gray-500 mt-1">
            <span>{{ job.productService | slice:0:25 }}...</span>
            <span class="mx-1.5">•</span>
            <span class="font-medium text-gray-700">{{ 'THB' + (job.value | number:'1.0-0') }}</span>
            @if (activeTab() === 'sold' && job.saleDate) {
              <span class="mx-1.5">•</span>
              <span class="font-medium">
                ขาย: {{ formatThaiDateShort(job.saleDate) }}
              </span>
            }
            @if (activeTab() !== 'sold' && job.nextAppointment) {
              <span class="mx-1.5">•</span>
              <span class="font-medium"
                    [class.font-medium]="isAppointmentInFuture(job.nextAppointment)"
                    [class.text-red-600]="isAppointmentOverdue(job.nextAppointment)">
                นัด: {{ formatThaiDateShort(job.nextAppointment) }}
              </span>
            }
          </div>
        </div>
     } @empty {
        <div class="text-center py-16 bg-white rounded-lg">
            <h3 class="text-xl font-medium text-gray-800">ไม่มีรายการ</h3>
            <p class="text-base text-gray-500 mt-1">ไม่พบงานขายในสถานะนี้</p>
        </div>
     }
  </div>

</div>
